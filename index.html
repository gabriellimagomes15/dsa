<!doctype html>
<html lang="pt">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Jobs Vacancies and Companies Reviews Analysis</title>

  <script src="http://code.jquery.com/jquery-3.2.1.js"></script>
  <script src="http://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

  <script type="text/javascript" src='js/d3.min.js'></script>
  <script type="text/javascript" src='js/charts.js'></script>
  <script type="text/javascript" src='js/d3ScaleColor.js'></script>
  <script type="text/javascript" src='js/cloud.js'></script> 
  <script type="text/javascript" src='js/bootstrap/bootstrap.min.js'></script> 

  <script src="https://code.highcharts.com/maps/highmaps.js"></script>
  <script src="https://code.highcharts.com/maps/modules/data.js"></script>
  <script src="https://code.highcharts.com/mapdata/custom/europe.js"></script>
  
  <script src='js/usa-and-canada.js'></script>

  <script src="https://use.fontawesome.com/e6b4ddaa2c.js"></script>

  <link href="vendor/datatables/dataTables.bootstrap4.css" rel="stylesheet">

  <link rel="stylesheet" type="text/css" href="css/charts.css">

  <link href="css/sb-admin.css" rel="stylesheet">

  <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

  <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  
  <link href="vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">

<style type="text/css">
  .card.text-whit{e
    box-shadow: 7px 7px 5px #ccc;
  }
  .fade.in {
    opacity: 1;
  }

  h1 {
    border-bottom: 3px solid #ccc;
    padding: 0 0 10px 0;
  }

  .card-body{
    text-align: center;
  }

  .dropdown-menu-center {
    left: 50%;
    right: auto;
    text-align: center;
    transform: translate(-50%, 0);
  }
</style>
	
</head>
<body class="fixed-nav sticky-footer bg-dark" id="page-top" >
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top" id="mainNav">
    <a class="navbar-brand" href="index.html">Home</a>
    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="navbar-collapse collapse " id="navbarResponsive">
      <ul class="navbar-nav navbar-sidenav" id="exampleAccordion">
        <li class="nav-item" data-toggle="tooltip" data-placement="right" title="Home">
          <a class="nav-link" href="#initial" data-toggle="tab">
            <i class="fa fa-fw fa-home"></i>
            <span class="nav-link-text">Home</span>
          </a>
        </li>
        <li class="nav-item" data-toggle="tooltip" data-placement="right" title="Dashboard">
          <a id='menudashboardjobs' class="nav-link" href="#dashboardjobs" data-toggle="tab">
            <i class="fa fa-fw fa-dashboard"></i>
            <span class="nav-link-text">Dashboard Jobs Vacancies</span>
          </a>
        </li>
        <li class="nav-item" data-toggle="tooltip" data-placement="right" title="Dashboard">
          <a id='menudashboardreviews' class="nav-link" href="#dashboardreviews" data-toggle="tab">
            <i class="fa fa-fw fa-dashboard"></i>
            <span class="nav-link-text">Dashboard Companies Reviews</span>
          </a>
        </li>
        <li class="nav-item" data-toggle="tooltip" data-placement="right" title="About">
          <a class="nav-link" href="#about" data-toggle="tab">
            <i class="fa fa-fw fa-info"></i>
            <span class="nav-link-text">About</span>
          </a>
        </li>
        <li class="nav-item" data-toggle="tooltip" data-placement="right" title="Contact">
          <a class="nav-link" href="#contact" data-toggle="tab">
            <i class="fa fa-fw fa-pencil"></i>
            <span class="nav-link-text">Contact</span>
          </a>
        </li>
      </ul>
      <ul class="navbar-nav sidenav-toggler">
        <li class="nav-item">
          <a class="nav-link text-center" id="sidenavToggler">
            <i class="fa fa-fw fa-angle-left"></i>
          </a>
        </li>
      </ul>
      <ul class="navbar-nav ml-auto">
        <li class="nav-item">
          <a href="https://github.com/gabriellimagomes15"  target="_blank"
         class="header-logo-invertocat my-0" style="padding: 5px 10px" data-toggle="tooltip" 
         data-placement="bottom" title="GitHub!" >
            <svg aria-hidden="true" class="octicon octicon-mark-github" style="fill: #fff;"
              height="30" version="1.1" viewBox="0 0 16 16" width="32">
              <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path>
            </svg>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" data-toggle="modal" data-target="#exampleModal">
            <i class="fa fa-fw fa-sign-out"></i>Logout</a>
        </li>
      </ul>
    </div>
  </nav>
  <div class="content-wrapper tab-content">
    <div id='initial' class="container-fluid tab-pane fade in active " role="tabpanel">
      <div class="jumbotron container">
          <div class="col-md-10">
            <h1>Jobs Vacancies Analysis</h1>
          </div>
          <div class="col-md-10">
            <p> This is a web app to analysis jobs vacancies data, with dashboards about 
              posts vacancies by date, skills (tech skills, languages and educations), jobs by cities, positions, cluster data mining of requeriments.</p>
            <p>The date were collect in Glassdoor.com by web scrapping.</p>
            <div class="alert alert-success">
              <p><strong> <span class='numbjobs'> More of 1,000 </span> jobs vacancies.</strong></p>
            </div>
          </div>
      </div>
    </div>
    <div id='dashboardjobs' class="container-fluid tab-pane fade  " role="tabpanel">
      <!-- Breadcrumbs-->
      <ol class="breadcrumb">
        <li class="breadcrumb-item active">Dashboard Jobs Vacancies </li>
      </ol>
      <!-- Boxes Informations -->
      <div class="row">
        <div class="col-xl-3 col-sm-6 mb-3">
          <div class="card text-white bg-primary o-hidden h-70">
            <div class="card-body boxone">
              <div class="card-body-icon">
                <i class="fa fa-fw fa-database"></i>
              </div>
              <div id='boxnumber' class="mr-5"></div>
            </div>
          </div>
        </div>
        <div class="col-xl-3 col-sm-6 mb-3">
          <div class="card text-white bg-warning h-70">
            <div class="card-body boxtwo">
              <div class="card-body-icon">
                <i class="fa fa-fw fa-globe"></i>
              </div>
              <div id='boxnumbertwo' class="mr-5"></div>
            </div>
            <div class="dropdown" style="">
                <select id='selcountry' class="selectpicker bg-warning text-white" style="width: 100%">
                  <option value="todos"> Todos </option>
                </select>
            </div>
          </div>
        </div>
        <div class="col-xl-3 col-sm-6 mb-3">
          <div class="card text-white bg-success o-hidden h-70">
            <div class="card-body boxthird">
              <div class="card-body-icon">
                <i class="fa fa-fw fa-location-arrow"></i>
              </div>
              <div id='boxnumberthird' class="mr-5"></div>
            </div>
          </div>
        </div>
        <div class="col-xl-3 col-sm-6 mb-3">
          <div class="card text-white bg-danger o-hidden h-70">
            <div class="card-body boxfour">
              <div class="card-body-icon">
                <i class="fa fa-fw fa-building"></i>
              </div>
              <div id='boxnumberfour' class="mr-5"></div>
            </div>
          </div>
        </div>
      </div>
      <!-- End Boxes Informations -->
      <div class="card mb-3">
        <div class="card-header">
          <i class="fa fa-line-chart"></i> Jobs Vacancies by Date</div>
        <div id='linechart' class="card-body" ></div>
        <div class="card-footer small text-muted">Updated in <span></span></div>
      </div>
      <div class="row">
        <div class="col-lg-8">
          <div class="card mb-3">
            <div class="card-header">
              <i class="fa fa-bar-chart"></i> Jobs Position</div>
            <div id='barchart' class="card-body"></div>
            <div class="card-footer small text-muted">Updated in <span></span></div>
          </div>
          
          <div class="card mb-3">
            <div class="card-header"><i class="fa fa-trello"></i> Treemap of Jobs Vacancies by City</div>
            <div id='treemap' class="card-body"></div>
            <div class="card-footer small text-muted">Updated in <span></span></div>
          </div>
          
          <div class="card mb-3">
            <div class="card-header"><i class="fa fa-map"></i> Map of Requirements Cluster by States</div>
            <div id='clustermap' class="card-body col-sm-12 my-auto" ></div>
                <!--div id="container" style="height: 600px; min-width: 310px; max-width: 980px; margin: 0 auto"></div-->
            <div class="card-footer small text-muted">Updated in <span></span></div>
          </div>
        </div>
        <div class="col-lg-4">
          <div class="card mb-3">
            <div class="card-header">
              <i class="fa fa-pie-chart"></i> Languages Requirements</div>
            <div id='piechart' class="card-body"></div>
            <div class="card-footer small text-muted">Updated in <span></span></div>
          </div>
          
          <div class="card mb-3">
            <div class="card-header">
              <i class="fa fa-pie-chart"></i> Education Requirements</div>
            <div id='piecharttwo' class="card-body"></div>
            <div class="card-footer small text-muted">Updated in <span></span></div>
          </div>
          
          <div class="card mb-3">
            <div class="card-header">
              <i class="fa fa-circle"></i> Tech Skills Requirements</div>
            <div id='bubblechart' class="card-body"></div>
            <div class="card-footer small text-muted">Updated in <span></span></div>
          </div>
        </div>        
      </div>
    </div> 
    <!-- FIM DIV dashboardjobs-->

    <div id='dashboardreviews' class="container-fluid tab-pane fade  " role="tabpanel">
      <ol class="breadcrumb">
        <li class="breadcrumb-item active">Dashboard Companies Reviews</li>
      </ol>
      <div class="row">
        <div class="col-xl-3 col-sm-6 mb-3">
          <div class="card text-white bg-inf o-hidden h-70 boxonereview">
            <div class="card-body ">
              <div class="card-body-icon">
                <i class="fa fa-fw fa-database"></i>
              </div>
              <div id='boxonereview' class="mr-5"></div>
            </div>
          </div>
        </div>
        <div class="col-xl-3 col-sm-6 mb-3">
          <div class="card text-white bg-dar h-70  boxtworeview" >
            <div class="card-body ">
              <div class="card-body-icon">
                <i class="fa fa-fw fa-globe"></i>
              </div>
              <div id='boxtworeview' class="mr-5"></div>
            </div>
            <div class="dropdown" style="">
                <select id='selcompany' class="selectpicker bg-dar text-white" 
                        style="width: 100%; ">
                  <option value="todos"> Todos </option>
                </select>
            </div>
          </div>
        </div>
        <div class="col-xl-3 col-sm-6 mb-3">
          <div class="card text-white bg-succes o-hidden h-70 boxthirdreview">
            <div class="card-body ">
              <div class="card-body-icon">
                <i class="fa fa-fw fa-location-arrow"></i>
              </div>
              <div id='boxthirdreview' class="mr-5"></div>
            </div>
          </div>
        </div>
        <div class="col-xl-3 col-sm-6 mb-3">
          <div class="card text-white bg-inf o-hidden h-70 boxfourreview" >
            <div class="card-body ">
              <div class="card-body-icon">
                <i class="fa fa-fw fa-building"></i>
              </div>
              <div id='boxfourreview' class="mr-5"></div>
            </div>
          </div>
        </div>
      </div>
      <div class="card mb-3">
        <div class="card-header">
          <i class="fa fa-bar-chart"></i> Reviews by Year</div>
        <div id='barchartreviews' class="card-body" ></div>
        <div class="card-footer small text-muted">Updated in <span></span></div>
      </div>
      <div class="row">
          <div class="col-lg-6">
            <div class="card mb-3">
              <div class="card-header">
                <i class="fa fa-circle"></i> Cons Comments</div>
              <div id='bubblecons' class="card-body"></div>
              <div class="card-footer small text-muted">Updated in <span></span></div>
            </div>
          </div>
          <div class="col-lg-6">
            <div class="card mb-3">
              <div class="card-header">
                <i class="fa fa-circle"></i> Pros Comments</div>
              <div id='bubblepros' class="card-body"></div>
              <div class="card-footer small text-muted">Updated in <span></span></div>
            </div>            
          </div>
      </div>
      <div class="card mb-3">
        <div class="card-header">
          <i class="fa fa-bar-chart"></i> Total of Positions (top 10)</div>
        <div id='positionchart' class="card-body"></div>
        <div class="card-footer small text-muted">Updated in <span></span></div>
      </div>
      <div class="row">
        <div class="col-lg-8">
          <div class="card mb-3">
            <div class="card-header"><i class="fa fa-trello"></i> Treemap of Reviews  by City</div>
            <div id='treemapreview' class="card-body"></div>
            <div class="card-footer small text-muted">Updated in <span></span></div>
          </div>
          <div class="card mb-3">
            <div class="card-header"><i class="fa fa-map"></i> Map of Requirements Cluster by States</div>
            <div id='clustermap' class="card-body col-sm-12 my-auto" ></div>
                <!--div id="container" style="height: 600px; min-width: 310px; max-width: 980px; margin: 0 auto"></div-->
            <div class="card-footer small text-muted">Updated in <span></span></div>
          </div>
        </div>

        <div class="col-lg-4">
          <div class="card mb-3">
            <div class="card-header">
              <i class="fa fa-pie-chart"></i> Recommends </div>
            <div id='pierecommend' class="card-body"></div>
            <div class="card-footer small text-muted">Updated in <span></span></div>
          </div>
        </div>        
      </div>  
    </div> 
    <!-- FIM DIV dashboardreviews-->

    <div id='about' class="container-fluid tab-pane fade " role="tabpanel">
      <div class="container jumbotron">
        <div class="col-md-12">
          <h1>About</h1>
        </div>
        <div class="col-md 10">
          <p>
            This application aims to make analysis of job vacancies in data science.
          </p>
          <p>
            The data was collected by doing a web scrape on the employment site, <a href='https://www.glassdoor.com/index.htm'> glassdoor.com </a>. This data has undergone a cleanup and transformation process and has also been applied clustering data mining algorithm to identify provinces that have similar requirements.
          </p>
        </div>
      </div>
    </div>

    <div id='contact' class="container-fluid tab-pane fade " role="tabpanel">
        <div class="jumbotron container">
          <div class="row">
            <div class="col-md-10">
              <h1>Contact me</h1>
            </div>
            <div class="col-md-10">
              <h3><b>Email:</b></h3> 
              <h4>gabriel.lg08@gmail.com</h4>
            </div>
            <div class="col-md-10">
              <h3><b>Phone</b></h3> 
              <h4>+55 61 985094857</h4>
            </div>
            <div class="col-sm-6">
              <a href="https://github.com/gabriellimagomes15">
                  <img style="width:50%;margin-left: -1em;" 
                  src="https://www.monolitonimbus.com.br/wp-content/uploads/2017/12/github.png"/>
              </a>
            </div>
            <div class="col-sm-6">
              <a href="https://www.linkedin.com/in/gabriellimagomes/">
                <img style="width:15%" 
                  src="https://media.licdn.com/mpr/mpr/shrink_200_200/AAEAAQAAAAAAAANyAAAAJGRlZTNlZDQwLTk4YTItNDA1MS04MzBjLWJmNGQ5M2RmZGUxYw.png"/>
                </a>
            </div>
          </div>
        </div>
    </div>

    <footer class="sticky-footer">
      <div class="container">
        <div class="text-center">
          <small>Copyright © Gabriel Lima Gomes 2018</small>
        </div>
      </div>
    </footer>
    <a class="scroll-to-top rounded" href="#page-top" style="display: inline;">
      <i class="fa fa-angle-up"></i>
    </a>

<script>
  
// CRIANDO OBJETO PARA GERAR OS 'tooltip' DOS GRÁFICOS
var tooltip = d3.select("body").append("div").attr("class", "toolTip");

// CRIANDO OBJETO PARA CONVERTER DATAS
var parseTime = d3.timeParse("%Y-%m-%d");

// CRIANDO OBJETO PARA FORMATAR NÚMERO
var format = d3.format(",d"); 


//CHAMANDO A FUNÇÃO PARA CARREGAR OS DADOS 
readData();

// FUNÇÃO PARA MONSTAR OS GRÁFICOS AO SELECIONAR O MENU 'DASHBOARDS JOBS VACANCIES'
$('#menudashboardjobs').on('click',function(e){
    setTimeout(chartsJobs,700,'');
})

// FUNÇÃO PARA REFAZER OS GRÁFICOS AO SELECIONAR UM PAÍS
$('#selcountry').on('change',function(){
  chartsJobs(this.value)
})

// FUNÇÃO PARA REDIMENSIONAR OS GRÁFICOS AO ALTERAR O ZOOM DA PÁGINA
function resize(){
  if( $('#dashboardjobs').hasClass('active')) {
    $('.card-body > *').empty()
    chartsJobs($('#selcountry').val()) 
  }
}

// FUNÇÃO PARA MONSTAR OS GRAFICOS DO DASHBOARDS DO MENU 'JOBS VACANCIES'
function chartsJobs(countrySelect){
  console.log('Charts')
  $('.card-body > *').empty() // LIMPANDO OS GRÁFICOS

  d3.csv('data/clusterReq2.csv', function(error, data){
      
      // FILTRANDO OS DADOS DE ACORDO COM O PAÍS SELECIONADO 
      data = data.filter(function(x) {  
        if(countrySelect == 'Todos' || countrySelect == ''){
          return x
        }else{
          return x.country == countrySelect
        }
      })

      // FUNÇÃO PARA MONTAR O MAPA
      $.getJSON('data/t5.geojson', function (geojson) {
          Highcharts.mapChart('clustermap', {

              chart: {
              spacingBottom: 20
          },
          title: {
              text: ''
          },

          legend: {
              enabled: true
          },

           mapNavigation: {
              enabled: true
          },
          plotOptions: {
              map: {
                  allAreas: false,
                  joinBy: ['sigla', 'code'],
                  dataLabels: {
                      enabled: true,
                      color: '#FFFFFF',
                      formatter: function () {
                          if (this.point.properties ) {
                              var label = this.point.properties['sigla'].replace('_br','')
                              return label;
                          }
                      },
                      format: null,
                      style: {
                          fontWeight: 'bold'
                      }
                  },
                  mapData: geojson,
                  tooltip: {
                      headerFormat: '',
                      pointFormat:  '{point.name}: <b>{series.name}</b>'
                  }
              }
          },
          series: [{
              name: 'Cluster 1',
              data: data.filter(function(x) {  return x.Cluster == '1'}).map(function(y){ return {code: y.state}})
            },{
              name: 'Cluster 2',
              data: data.filter(function(x) {  return x.Cluster == '2'}).map(function(y){ return {code: y.state}})
           },{
              name: 'Cluster 3',
              data: data.filter(function(x) {  return x.Cluster == '3'}).map(function(y){ return {code: y.state}})
           },{
              name: 'Cluster 4',
              data: data.filter(function(x) {  return x.Cluster == '4'}).map(function(y){ return {code: y.state}})
           }
          ]
        });
      });
  });


      // PEGANDO OS DADOS jobs DA LISTA 'dados'
      var data = dados.jobs


/******** MONTANDO INFORMAÇÕES NÚMERICAS NOS BOXES  ****************************/
      //SELECIONANDO DIV 
      var div2 = d3.select('#boxnumbertwo')

      // AGRUPANDO PAÍSES E FAZENDO A CONTAGEM
      var countCountry = group(data,['country'])
      d3.select('.boxtwo .card-body-icon').append('i').classed('fa fa-fw fa-globe', true)
      
      $('#selcountry > *').remove();
      $('#selcountry').append($('<option>',{
          value: 'Todos',
          text: 'Todos'
      })) 
      $.each(countCountry,function(x,y){
        $('#selcountry').append($('<option>',{
          value: y.value,
          text: y.value
        }))
      })
      if(countrySelect != ''){
        $('#selcountry').val(countrySelect);
      }

      boxNumber2.call(div2, {docs: countCountry, title: "Countries"})
      

      data = data.filter(function(x) {
        if(countrySelect == 'Todos' || countrySelect == ''){
          return x
        }else{
          return x.country == countrySelect
        }
      })


      //TOTAL DE INSTITUIÇÕES PARTICIPANTES
      var div1 = d3.select('#boxnumber')
      
      d3.select('.boxone .card-body-icon').append('i').classed('fa fa-fw fa-database', true)
      //CHAMANDO A FUNÇÃO PARA MONTAR BOX 
      boxNumber2.call(div1, {docs: data, title: "Jobs Vacancies"})

      //Number of jobs in initial page
      d3.select('.numbjobs').text(data.length.toLocaleString('de-DE'))

      //SELECTIONANDO DIV
      var div2 = d3.select('#boxnumberthird')
      
      // AGRUPANDO CIDADES E FAZENDO CONTAGEM
      var countCities = group(data,['city'])
      d3.select('.boxthird .card-body-icon').append('i').classed('fa fa-fw fa-location-arrow ', true)   
      //CHAMANDO A FUNÇÃO PARA MONTAR BOX
      boxNumber2.call(div2, {docs: countCities, title: "Cities"})

      var div2 = d3.select('#boxnumberfour')
      d3.select('.boxfour .card-body-icon').append('i').classed('fa fa-fw fa-building', true)   

      //AGRUPANDO POSITION E FAZENDO CONTAGEM
      var countPositions = group(data,['position'])
      boxNumber2.call(div2, {docs: countPositions, title: "Positions"})

      // PEGANDO A DATA MAIS ATUAL DE COLETA DOS DADOS
      var dateUpdate = group(data, ['dateCollect'])
      dateUpdate.sort(function(x, y){        
        return d3.descending(x.value,y.value);
      })
      var divUpdate = d3.selectAll('.card-footer span').text(dateUpdate[0].value)
      
      

/******** GRAFICO DE LINHA ****************************/
      //DEFININDO O VALOR DE w E h DE ACORDO COM O TAMANHO DA DIV (90% e 7x maior)
      // DEFINIDO ASSIM PARA MONTAR OS GRÁFICOS RESPONSIVOS
      var w = parseInt(d3.select('#linechart').style('width')) *0.90,
          h = parseInt(d3.select('#linechart').style('height')) *7
          if(h == 0){
             h = w * 0.2
          }

      // CHAMANDO FUNÇÃO PARA INICIAR AS VARIAVEIS NECESSÁRIAS PARA MONTAR O GRÁFICO
        // PASSANDO COMO PARAMETRO A id DIV, TITULO DA TIVE, LARGURA E ALTURA DO GRAFICO
      var line  = initVar.call(null, {id: '#linechart', titleDiv: "", class: '', width: w, height: h})
      
      //AGRUPANDO OS DADOS POR DATA
      groupDate = group(data,['date'])

      //CONVERTENDO AS DATAS DE STRING PARA DATE
      groupDate.map(function(x){
        x.value = parseTime(x.value)
      })
      
      // ORDENAÇÃO DAS DATAS
      groupDate.sort(function(x, y){        
        return y.value - x.value;
      })

      //CHAMANDO FUNÇÃO PARA CRIAR O GRÁFICO DE LINHAS
        //PARAMETROS: g, dados e as margins
      lineChart.call(line.g, {data:groupDate, margins: line.margins})

/******** GRAFICO DE BOLHAS ****************************/
      w = parseInt(d3.select('#bubblechart').style('width')) * 0.9,
      h = parseInt(d3.select('#bubblechart').style('height')) * 9

      var bolha = initVar.call(null, {id: '#bubblechart', titleDiv: "", class: '', width: w, height:h})

      //CRIANDO ARRAY PARA ARMAZENAR SKILL SEPARADOS
      var arraySkill = []

      //FAZENDO SLIPT DA SKILLS
      data.map(function(x){
        x.skills.split(' ').map(function(d){
          arraySkill.push({skill:d})
        })
      })
      var groupSkill = group(arraySkill,['skill'])

      //RETORNANDO REGISTROS QUE NÃO SEJA VAZIO
      groupSkill = groupSkill.filter(function(x) {return x.value != "" })
      
      // RETORNANDO REGISTROS QUE TENHAM CONTAGEM ACIMA DE 15
      groupSkill = groupSkill.filter(function(x){return x.count > 15})

      //ORDENANDO O ARRAY DE SKILLS
      groupSkill.sort(function(x,y){
        return y.count - x.count
      })

      // AJUSTANDO AS MARGINS DA DIV QUE SERÁ CRIADO O GRÁFICO DE BOLHAS
      bolha.margins.margin.bottom = 100;
      bolha.margins.margin.left = 30;

      // INSERINDO ATRIBUTOS DE FORMATAÇÃO NO ELEMENTO DO GRÁFICO DE BOLHAS 
      bolha.g.attr("text-anchor","middle").attr('font-family',"sans-serif").attr('font-size',"10")
      bubbleChart.call(bolha.g, {data: groupSkill,margins: bolha.margins})

/******** GRAFICO DE BARRAS ****************************/
      //CAPTURANDO O TAMANHO DA DIV
      w = parseInt(d3.select('#barchart').style('width')) * 0.9 ,
      h = parseInt(d3.select('#barchart').style('width')) * 0.5;//É UTILIZADA O WIDTH PORQUE O HEIGTH NÃO É DEFINIDO 

      
      var bar = initVar.call(null, {id: '#barchart', titleDiv: "", class: '', width: w, height:h})    
      
      var groupJobs = group(data, ['position'])
      
      
      var x = d3.scaleBand().range([0,bar.margins.width]).padding(0.1),
          //x = d3.scaleLinear().rangeRound([0,bar.margins.width]),
          y = d3.scaleLinear().rangeRound([bar.margins.height,0])
          //y = d3.scaleBand().range([bar.margins.height, 0]).padding(0.1);

      groupJobs.sort(function(x,y){
        return y.count - x.count;
      })
      groupJobs = groupJobs.slice(0,5)
      
      //CHAMANDO FUNÇÃO QUE MONTA O GRÁFICO DE BARRAS
        //PARAMETROS: elemento G, dados, marnins, axis, se as barras serão horizontal(true) ou vertical(false) E se as barras serão de cor sólida de acordo com CSS criado
          //se FALSE irá usar uma escala de cor (azul)
      barChart.call(bar.g, {data: groupJobs, margins: bar, axis: {x : x, y : y},horizontal: false, setFill: true } )

/******** GRAFICO DE PIZZA LANGUAGES****************************/
      var pie = initVar.call(null, {id: '#piechart', titleDiv: "", class: '', width: '300', height:'250'})    
      

      var arrayLang = []
      data.map(function(x){      
        x.language.split(' ').map(function(d){      
          arrayLang.push({language:d})
        })
      })
      var groupLang = group(arrayLang,['language'])
      groupLang = groupLang.filter(function(x) {return x.value != "" })

      pieChar.call(pie.g, {data: groupLang, margins: pie})

/******** GRAFICO DE PIZZA EDUCATION ****************************/
      var pieEdu = initVar.call(null, {id: '#piecharttwo', titleDiv: "", class: '', width: '300', height:'250'})    

      var arrayEdu = []
      data.map(function(x){      
        x.education.split(' ').map(function(d){      
          arrayEdu.push({education:d})
        })
      })
      var groupLang = group(arrayEdu,['education'])
      groupLang = groupLang.filter(function(x) {return x.value != "" })

      pieChar.call(pieEdu.g, {data: groupLang, margins: pieEdu})



/******** GRAFICO TREEMAP ****************************/
      w = parseInt(d3.select('#treemap').style('width')) * 0.9,
      h = parseInt(d3.select('#treemap').style('height')) * 12
      var barCity = initVar.call(null, {id: '#treemap', titleDiv: "", class: 'treemap', width: w, height:h})    

      var groupCity = group(data, ['city'])
      
      var x = d3.scaleBand().range([0,barCity.margins.width]).padding(0.1),
          y = d3.scaleLinear().rangeRound([barCity.margins.height,0]);

      groupCity.sort(function(x,y){
        return y.count - x.count;
      })
      groupCity = groupCity.filter(function(x) {return x.value != 'ND'}).slice(0,20)
      
      treeMap.call(barCity.g, {data: groupCity, margins: barCity.margins})  

} //FIM FUNÇÃO chartsjobs


//CHAMANDO FUNÇÃO PARA MONTAR GRÁFICOS A SELECIONA O MENU companies Reviews
$('#menudashboardreviews').on('click',function(e){
    setTimeout(chartsReviews,700,'');
})

//REFAZENDO GRÁFICOS AO SELECIONA UMA EMPRESA NO COMBO
$('#selcompany').on('change',function(){
  chartsReviews(this.value)
})


//FUNÇÃO PARA MONTAR OS GRÁFICOS DE REVIEWS.
 // PARAMETRO: empresa selecionada no combo
function chartsReviews(companySelect){
  console.log('Charts')
  $('.card-body > *').empty()

      // CAPTURANDO REVIEWS DA LISTA 'dados'
      data = dados.reviews

/******** INFORMAÇÕES NUMÉRICAS (BOXES) ****************************/
      var div2         = d3.select('#boxtworeview')
      var countCompany = group(data,['company'])
      var scaleColor   = d3.scaleSequential(d3["interpolateBlues"]).domain([-1, 5]);

      d3.select('.boxtworeview .card-body-icon').append('i').classed('fa fa-fw fa-building', true)
      d3.select('.boxtworeview').style('background-color', scaleColor(2))//ALTERANDO A COR DA DIV. SERÁ UTILIZADA ESCALA DE COR AZUL
      d3.select('#selcompany').style('background-color', scaleColor(2))//ALTERANDO A COR DA DIV. SERÁ UTILIZADA ESCALA DE COR AZUL
     

      $('#selcompany > *').remove();
      $('#selcompany').append($('<option>',{
          value: 'Todos',
          text: 'Todos'
      })) 
      $.each(countCompany,function(x,y){
        $('#selcompany').append($('<option>',{
          value: y.value,
          text: y.value
        }))
      })
      if(companySelect != ''){
        $('#selcompany').val(companySelect);
      }

      boxNumber2.call(div2, {docs: countCompany, title: "Companies"})

      data = data.filter(function(x) {
        if(companySelect == 'Todos' || companySelect == ''){
          return x
        }else{
          return x.company == companySelect
        }
      })

      var div1 = d3.select('#boxonereview')
      d3.select('.boxonereview .card-body-icon').append('i').classed('fa fa-fw fa-database', true)
               d3.select('.boxonereview').style('background-color', scaleColor(1))

      boxNumber2.call(div1, {docs: data, title: "Reviews"})

      
      var div3         = d3.select('#boxfourreview')

      //CALCULANDO AS MÉTRICAS DE RATING(media, soma, min, max)
      var metricRating = groupMetric(data,'company','rating')
      var title1 = 'Mean Rating' //TITULO DA DIV
      d3.select('.boxthirdreview .card-body-icon').append('i').classed('fa fa-fw fa-calculator ', true)   
      d3.select('.boxthirdreview').style('background-color', scaleColor(3))

      var format = d3.format(".3n");
      
      var avg = d3.mean(metricRating, function(x){ return x.count.avg })

      // INSERINDO INFORMAÇÕES NA DIV COM EFEITOS DE TRANSITIONS
      div3.append('span')   
          .transition()
          .duration(1500)
          .on("start", function repeat() {
            d3.active(this)
              .tween("text", function() {
                  var that = d3.select(this),
                      i = d3.interpolateNumber(that.text().replace(/,/g, ""), avg);
                  return function(t) { that.text( title1 + ' ' + format(i(t))); };
              })
              .transition()
              .delay(2000)
          });

      var div4 = d3.select('#boxthirdreview')
      d3.select('.boxfourreview .card-body-icon').append('i').classed('fa fa-fw fa-building', true)  
      d3.select('.boxfourreview').style('background-color', scaleColor(4))

      var title2 = 'Min Rating'
      var min = d3.min(metricRating, function(x){ return x.count.min})
      
      div4.append('span')   
                .transition()
                .duration(1500)
                .on("start", function repeat() {
                  d3.active(this)
                    .tween("text", function() {
                        var that = d3.select(this),
                            i = d3.interpolateNumber(that.text().replace(/,/g, ""), min);
                        return function(t) { that.text( title2 + ' ' + format(i(t))); };
                    })
                    .transition()
                    .delay(2000)
                });

      var title3 = 'Max Rating'
      var max = d3.max(metricRating, function(x){ return x.count.max})
      div4.append('br')
      div4.append('span')   
                .transition()
                .duration(1500)
                .on("start", function repeat() {
                  d3.active(this)
                    .tween("text", function() {
                        var that = d3.select(this),
                            i = d3.interpolateNumber(that.text().replace(/,/g, ""), max);
                        return function(t) { that.text( title3 + ' ' + format(i(t))); };
                    })
                    .transition()
                    .delay(2000)
                });


      var dateUpdate = group(data, ['dateCollect'])
      dateUpdate.sort(function(x, y){        
        return d3.descending(x.value,y.value);
      })
      
      var divUpdate = d3.selectAll('.card-footer span').text(dateUpdate[0].value)


/******** GRÁFICO DE BARRAS POSITIONS ****************************/
      w = parseInt(d3.select('#positionchart').style('width')) * 0.9 ,
      h = parseInt(d3.select('#positionchart').style('width')) * 0.25;

      
      var barPosition = initVar.call(null, {id: '#positionchart', titleDiv: "", class: '', width: w, height:h})    
      
      var x = d3.scaleBand().range([0,barPosition.margins.width]).padding(0.1),
          //x = d3.scaleLinear().rangeRound([0,barPosition.margins.width]),
          y = d3.scaleLinear().rangeRound([barPosition.margins.height,0])
          //y = d3.scaleBand().range([barPosition.margins.height, 0]).padding(0.1);

            
      var groupPosit = group(data,['position'])
      groupPosit = groupPosit.filter(function(x){ return x.value != ''})

      
      groupPosit.sort(function(x, y){        
        return y.count - x.count;
      })
  
      groupPosit = groupPosit.slice(0,10)
    
      barChart.call(barPosition.g, {data: groupPosit, margins: barPosition, axis: {x : x, y : y},horizontal: false, setFill: true } )  

/******** GRÁFICO DE BARRA DATE(YEAR) ****************************/
      w = parseInt(d3.select('#barchartreviews').style('width')) * 0.9 ,
      h = parseInt(d3.select('#barchartreviews').style('width')) * 0.25;

      var bar = initVar.call(null, {id: '#barchartreviews', titleDiv: "", class: '', width: w, height:h})    
      
      var x = d3.scaleBand().range([0,bar.margins.width]).padding(0.1),
          //x = d3.scaleLinear().rangeRound([0,bar.margins.width]),
          y = d3.scaleLinear().rangeRound([bar.margins.height,0])
          //y = d3.scaleBand().range([bar.margins.height, 0]).padding(0.1);

      var years = data.map(function(x){
        return {value: new Date(x.date).getFullYear() }
      })
            
      groupYear = group(years,['value'])
      groupYear = groupYear.filter(function(x){ return x.value != 'NaN'})
      
      groupYear.sort(function(x, y){        
        return x.value - y.value;
      })

      barChart.call(bar.g, {data: groupYear, margins: bar, axis: {x : x, y : y},horizontal: false, setFill: true } )

/******** GRÁFICO DE PIZZA RECOMMENDS ****************************/
      var pieRecommend = initVar.call(null, {id: '#pierecommend', titleDiv: "", class: '', width: '300', height:'250'})    
      
      var groupRecommend = group(data,['recommend'])
      groupRecommend = groupRecommend.filter(function(x) {return x.value != "" })

      pieChar.call(pieRecommend.g, {data: groupRecommend, margins: pieRecommend})

/******** GRÁFICO TREEMAP CITY ****************************/
      w = parseInt(d3.select('#treemapreview').style('width')) * 0.9,
      h = parseInt(d3.select('#treemapreview').style('height')) * 12
      var barCity = initVar.call(null, {id: '#treemapreview', titleDiv: "", class: 'treemap', width: w, height:h})    

      var groupCity = group(data, ['city'])
            
      var x = d3.scaleBand().range([0,barCity.margins.width]).padding(0.1),//d3.scaleLinear().rangeRound([0,vars.margins.width]),
          y = d3.scaleLinear().rangeRound([barCity.margins.height,0]);//d3.scaleBand().range([vars.margins.height, 0]).padding(0.1);

      groupCity.sort(function(x,y){
        return y.count - x.count;
      })
      groupCity = groupCity.filter(function(x) {return x.value != 'NI'}).slice(0,20)
      
      treeMap.call(barCity.g, {data: groupCity, margins: barCity.margins})

/******** GRÁFICO DE BOLHAS PROS ****************************/
      w = parseInt(d3.select('#bubblepros').style('width')) * 0.9,
      h = parseInt(d3.select('#bubblepros').style('height')) * 9

      var bubPros = initVar.call(null, {id: '#bubblepros', titleDiv: "", class: '', width: w, height:h})

      var arrayPros = []
      data.map(function(x){
        x.pros.split(' ').map(function(d){
          arrayPros.push({pros:d})
        })
      })
      var groupProsComents = group(arrayPros,['pros'])
      groupProsComents = groupProsComents.filter(function(x) {return x.value != "" })
      
      // RECUPERANDO AS 150 PRIMEIRAS PALAVRAS
      groupProsComents = groupProsComents.slice(0,150)
      groupProsComents.sort(function(x,y){
        return y.count - x.count
      })

      bubPros.margins.margin.bottom = 100;
      bubPros.margins.margin.left = 30;

      //INSERINDO ATRIBUTOS NO ELEMENTO
      bubPros.g.attr("text-anchor","middle").attr('font-family',"sans-serif").attr('font-size',"10")
      bubbleChart.call(bubPros.g, {data: groupProsComents,margins: bubPros.margins, setColor: 'interpolateGreens'})

/******** GRÁFICO DE BOLHAS CONS ****************************/
      w = parseInt(d3.select('#bubblecons').style('width')) * 0.9,
      h = parseInt(d3.select('#bubblecons').style('height')) * 9

      var bubCons = initVar.call(null, {id: '#bubblecons', titleDiv: "", class: '', width: w, height:h})

      var arrayCons = []
      data.map(function(x){
        x.cons.split(' ').map(function(d){
          arrayCons.push({pros:d})
        })
      })
      var groupConsComents = group(arrayCons,['pros'])
      groupConsComents = groupConsComents.filter(function(x) {return x.value != "" })
      groupConsComents = groupConsComents.slice(0,150)
      groupConsComents.sort(function(x,y){
        return y.count - x.count
      })

      bubCons.margins.margin.bottom = 100;
      bubCons.margins.margin.left = 30;

      bubCons.g.attr("text-anchor","middle").attr('font-family',"sans-serif").attr('font-size',"10")
      bubbleChart.call(bubCons.g, {data: groupConsComents,margins: bubCons.margins, setColor: 'interpolateReds'})


} // FIM FUNÇÃO CHARTSREVIEWS


  $("#sidenavToggler").click(function(e) {
    e.preventDefault();
    $("body").toggleClass("sidenav-toggled");
    $(".navbar-sidenav .nav-link-collapse").addClass("collapsed");
    $(".navbar-sidenav .sidenav-second-level, .navbar-sidenav .sidenav-third-level").removeClass("show");
  });
  $('.navbar-toggler').click(function(e){
    var id = $(this).data("target")
    $( id).addClass('show')
    //console.log($(this).data("target"))
  })
</script>
	</body>
</html>